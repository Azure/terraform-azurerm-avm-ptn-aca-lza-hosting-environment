<!-- BEGIN_TF_DOCS -->
<!-- Code generated by terraform-docs. DO NOT EDIT. -->
# Windows VM with Custom Certificate

This example demonstrates a complex Windows VM deployment with custom TLS certificates and no Application Gateway ingress.

```hcl
terraform {
  required_version = ">= 1.9, < 2.0"

  required_providers {
    azapi = {
      source  = "Azure/azapi"
      version = "~> 2.4"
    }
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "~> 4.0"
    }
    pkcs12 = {
      source  = "chilicat/pkcs12"
      version = "~> 0.0.7"
    }
    tls = {
      source  = "hashicorp/tls"
      version = "~> 4.0"
    }
  }
}

provider "azurerm" {
  features {}
  storage_use_azuread = true
}

# Generate a custom certificate for testing
resource "tls_private_key" "cert_key" {
  algorithm = "RSA"
  rsa_bits  = 2048
}

resource "tls_self_signed_cert" "cert" {
  allowed_uses = [
    "key_encipherment",
    "digital_signature",
    "server_auth",
  ]
  private_key_pem       = tls_private_key.cert_key.private_key_pem
  validity_period_hours = 8760 # 1 year
  dns_names             = [var.certificate_common_name]

  subject {
    common_name         = var.certificate_common_name
    country             = "US"
    locality            = "Seattle"
    organization        = "Contoso Test Corp"
    organizational_unit = "IT Department"
    province            = "WA"
  }
}

# Convert to PKCS12 format for Azure
resource "pkcs12_from_pem" "cert_pkcs12" {
  password        = var.certificate_password
  cert_pem        = tls_self_signed_cert.cert.cert_pem
  private_key_pem = tls_private_key.cert_key.private_key_pem
}

# Complex scenario: Windows VM with custom certificate and no Application Gateway
module "aca_lza_hosting" {
  source = "../../"

  # Custom certificate configuration (COMPLEX)
  application_gateway_certificate_key_name = var.certificate_key_name
  deployment_subnet_address_prefix         = "10.30.4.0/24"
  # Observability - mixed configuration
  enable_application_insights = true
  enable_dapr_instrumentation = false # Test mixed observability
  # Core - Let module create RG with custom name (COMPLEX)
  location                                        = var.location
  spoke_application_gateway_subnet_address_prefix = "10.30.3.0/24"
  spoke_infra_subnet_address_prefix               = "10.30.1.0/24"
  spoke_private_endpoints_subnet_address_prefix   = "10.30.2.0/24"
  # Spoke networking
  spoke_vnet_address_prefixes      = ["10.30.0.0/16"]
  vm_admin_password                = var.vm_admin_password
  vm_jumpbox_subnet_address_prefix = "10.30.5.0/24"
  # Windows VM with password authentication (COMPLEX)
  vm_size                                      = "Standard_DS2_v2"
  application_gateway_certificate_subject_name = "CN=${var.certificate_common_name}"
  application_gateway_fqdn                     = var.certificate_common_name
  base64_certificate                           = pkcs12_from_pem.cert_pkcs12.result
  created_resource_group_name                  = var.resource_group_name
  deploy_agent_pool                            = true
  # No sample app to test minimal deployment
  deploy_sample_application = false
  # No zone redundancy for cost optimization (COMPLEX test case)
  deploy_zone_redundant_resources = false
  # No DDoS protection for cost efficiency
  enable_ddos_protection = false
  enable_telemetry       = var.enable_telemetry
  environment            = var.environment
  # NO Application Gateway - test alternate ingress (COMPLEX)
  expose_container_apps_with = "none"
  # No hub integration - standalone spoke
  hub_virtual_network_resource_id = ""
  network_appliance_ip_address    = ""
  route_spoke_traffic_internally  = true
  tags                            = var.tags
  use_existing_resource_group     = false
  vm_authentication_type          = "password"
  vm_jumpbox_os_type              = "windows"
  vm_linux_ssh_authorized_key     = "" # Not used for Windows
  # Naming
  workload_name = var.workload_name
}




```

<!-- markdownlint-disable MD033 -->
## Requirements

The following requirements are needed by this module:

- <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) (>= 1.9, < 2.0)

- <a name="requirement_azapi"></a> [azapi](#requirement\_azapi) (~> 2.4)

- <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) (~> 4.0)

- <a name="requirement_pkcs12"></a> [pkcs12](#requirement\_pkcs12) (~> 0.0.7)

- <a name="requirement_tls"></a> [tls](#requirement\_tls) (~> 4.0)

## Resources

The following resources are used by this module:

- [pkcs12_from_pem.cert_pkcs12](https://registry.terraform.io/providers/chilicat/pkcs12/latest/docs/resources/from_pem) (resource)
- [tls_private_key.cert_key](https://registry.terraform.io/providers/hashicorp/tls/latest/docs/resources/private_key) (resource)
- [tls_self_signed_cert.cert](https://registry.terraform.io/providers/hashicorp/tls/latest/docs/resources/self_signed_cert) (resource)

<!-- markdownlint-disable MD013 -->
## Required Inputs

No required inputs.

## Optional Inputs

The following input variables are optional (have default values):

### <a name="input_certificate_common_name"></a> [certificate\_common\_name](#input\_certificate\_common\_name)

Description: The common name for the custom certificate.

Type: `string`

Default: `"wintest.contoso.com"`

### <a name="input_certificate_key_name"></a> [certificate\_key\_name](#input\_certificate\_key\_name)

Description: The name of the certificate key in Key Vault.

Type: `string`

Default: `"wintest-custom-cert"`

### <a name="input_certificate_password"></a> [certificate\_password](#input\_certificate\_password)

Description: The password for the certificate private key.

Type: `string`

Default: `"CertP@ssw0rd123!"`

### <a name="input_enable_telemetry"></a> [enable\_telemetry](#input\_enable\_telemetry)

Description: This variable controls whether or not telemetry is enabled for the module.

Type: `bool`

Default: `true`

### <a name="input_environment"></a> [environment](#input\_environment)

Description: The environment identifier for the module.

Type: `string`

Default: `"test"`

### <a name="input_location"></a> [location](#input\_location)

Description: The Azure region where the resources will be deployed.

Type: `string`

Default: `"East US"`

### <a name="input_resource_group_name"></a> [resource\_group\_name](#input\_resource\_group\_name)

Description: The name of the resource group to create.

Type: `string`

Default: `"rg-aca-lza-windows-test"`

### <a name="input_tags"></a> [tags](#input\_tags)

Description: Map of tags to assign to the resources.

Type: `map(string)`

Default: `{}`

### <a name="input_vm_admin_password"></a> [vm\_admin\_password](#input\_vm\_admin\_password)

Description: The password for the Windows VM administrator account.

Type: `string`

Default: `"WindowsP@ssw0rd123!"`

### <a name="input_workload_name"></a> [workload\_name](#input\_workload\_name)

Description: The name of the workload.

Type: `string`

Default: `"wintest"`

## Outputs

The following outputs are exported:

### <a name="output_certificate_thumbprint"></a> [certificate\_thumbprint](#output\_certificate\_thumbprint)

Description: Certificate thumbprint

### <a name="output_container_apps_environment_id"></a> [container\_apps\_environment\_id](#output\_container\_apps\_environment\_id)

Description: Container Apps Environment ID

### <a name="output_resource_group_name"></a> [resource\_group\_name](#output\_resource\_group\_name)

Description: Created resource group name

### <a name="output_windows_vm_id"></a> [windows\_vm\_id](#output\_windows\_vm\_id)

Description: Windows VM resource ID

## Modules

The following Modules are called:

### <a name="module_aca_lza_hosting"></a> [aca\_lza\_hosting](#module\_aca\_lza\_hosting)

Source: ../../

Version:

## Additional Resources

- [Azure Container Apps Landing Zone Accelerator](https://github.com/Azure/aca-landing-zone-accelerator)
- [Azure Verified Modules Documentation](https://azure.github.io/Azure-Verified-Modules/)
- [Azure Container Apps Documentation](https://docs.microsoft.com/azure/container-apps/)
<!-- END_TF_DOCS -->